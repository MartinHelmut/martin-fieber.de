---
date: 2023-02-27
lastmod: 2024-09-04
title: "Lua project setup with LuaRocks"
description: "A full guide on setting up a Lua project, including dependency management, code formatting and analysis, and editor setup. Part of a larger series about aspects of Lua."
image: "/assets/blog/lua-series-part-1/title-card.png"
imageAlt: "Showing a VS Code window in dark mode with an open Lua file and the sidebar on the left showing the contained project files that get built up in the series."
linkTitle: "A setup for lua projects, getting ready to built upon later."
banner: "/assets/blog/lua-series-part-1/banner.png"
bannerAlt: "Showing a VS Code window in dark mode with an open Lua file and the sidebar on the left showing the contained project files that get built up in the series."
summary: "<p>Setting up a project with Lua, running code, installing dependencies, code formatting, and static analysis, as well as the editor setup.</p>"
hasCode: true
tags: ["post", "lua"]
series: { name: lua, part: 1 }
---

<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/banner.png"
      alt="{{ bannerAlt }}"
      width="1360"
      height="399"
    />
  </picture>
  <figcaption>A look at the project setup created in this article.</figcaption>
</figure>
<h3>Coming from the moon</h3>
<p>
  Even though I already wrote an
  <a
    href="/blog/goodbye-snake-i-go-to-the-moon"
    title="An earlier article focusing on the overall picture."
    >overview of how to set up a Lua project</a
  >, this article, part of the longer
  <a href="/series/lua" title="Overview of the Lua article series."
    >Lua series</a
  >, will go into more detail on specific aspects with greater focus. Going
  through this, the goal is to have a solid foundation to further build on in
  later articles of this series or for any project to come.
</p>
<p>
  Running a first Lua program, using LuaRocks for dependency management, code
  formatting, and linting, and setting up an editor or
  <abbr title="Integrated Development Environment">IDE</abbr> to support Lua
  development as well as possible. <strong>Remark:</strong> This is
  <strong>how I set up my projects</strong>, maybe not by the books, but the way
  it works best for me in all environments, repeatedly.
</p>

<nav>
  <h3>Table of contents</h3>
  <ol>
    <li><a href="#lua-versions">Lua versions</a></li>
    <li>
      <a href="#installing-lua">Installing Lua</a>
      <ul>
        <li>
          <a href="#installing-lua-macos">macOS</a>
        </li>
        <li>
          <a href="#installing-lua-linux">Linux</a>
        </li>
        <li>
          <a href="#installing-lua-windows">Windows</a>
        </li>
      </ul>
    </li>
    <li><a href="#hello-world">Hello World</a></li>
    <li>
      <a href="#dependency-management-with-luarocks"
        >Dependency management with LuaRocks</a
      >
      <ul>
        <li>
          <a href="#dependency-management-with-luarocks-macos">macOS</a>
        </li>
        <li>
          <a href="#dependency-management-with-luarocks-linux">Linux</a>
        </li>
        <li>
          <a href="#dependency-management-with-luarocks-windows">Windows</a>
        </li>
      </ul>
    </li>
    <li><a href="#project-folder-setup">Project folder setup</a></li>
    <li><a href="#gitignore">.gitignore</a></li>
    <li><a href="#about-rockspec">About .rockspec</a></li>
    <li><a href="#install-a-module">Install a module</a></li>
    <li><a href="#resolve-module-paths">Resolve module paths</a></li>
    <li><a href="#rock-trees">Rock trees</a></li>
    <li><a href="#enable-local-scripts">Enable local scripts</a></li>
    <li><a href="#auto-format-code">Auto format code</a></li>
    <li><a href="#static-analysis">Static analysis</a></li>
    <li>
      <a href="#editor-setup">Editor setup</a>
      <ul>
        <li>
          <a href="#editor-setup-jetbrains">JetBrains (CLion)</a>
        </li>
        <li>
          <a href="#editor-setup-visual-studio-code">Visual Studio Code</a>
        </li>
        <li>
          <a href="#editor-setup-sublime-text">Sublime Text 4</a>
        </li>
        <li>
          <a href="#editor-setup-zerobrane">ZeroBrane</a>
        </li>
        <li>
          <a href="#editor-setup-honorable-mentions">Honorable mentions</a>
        </li>
      </ul>
    </li>
    <li><a href="#what-comes-next">What comes next</a></li>
  </ol>
</nav>

<hr />

<h3 id="lua-versions">Lua versions</h3>
<p>
  A note about versions. The latest Lua version as of this writing is 5.4
  (released in
  <time datetime="2020-05-29">June 2020</time>). Generally, everything in this
  article series will work with Lua 5.1 (released in
  <time datetime="2006-02-21">February 2006</time>) and up. If this is not the
  case, a callout such as the following will signal that a higher version is
  required.
</p>
<aside class="callout">
  <h4>Example: Lua version required</h4>
  <p>This feature requires Lua 5.x and up.</p>
</aside>
<p>
  For instance,
  <a
    href="/blog/debugging-and-profiling-lua/"
    title="Article about debugging and profiling Lua, using a Lua 5.4 feature."
    >in a later article</a
  >, I will use the meta-method <code>__close</code>, added in Lua 5.4, for a
  simple profiling tool.
</p>
<p>
  An overview of the versions and their respective main features can be found on
  the
  <a href="https://www.lua.org/versions.html" title="Lua version release log."
    >official Lua version history</a
  >
  page.
</p>

<h3 id="installing-lua">Installing Lua</h3>
<p>
  First things first, let's check if Lua is already installed on the system by
  running Lua's version command <code>lua -v</code> in a terminal.
</p>
<figure>
  <pre><code class="language-shell hljs">$ lua -v
Lua 5.4.4  Copyright (C) 1994-2022 Lua.org, PUC-Rio</code></pre>
  <figcaption>
    The <code>$</code> is used to show a command will be entered.
  </figcaption>
</figure>
<p>
  If it prints something similar to the above, it's already good to go. If not,
  Lua needs to be installed first.
</p>

<h4 id="installing-lua-macos">macOS</h4>
<p>
  <a href="https://brew.sh" title="Brew homepage">Brew on macOS</a> can be used
  to install an up-to-date version of Lua.
</p>
<figure>
  <pre><code class="language-shell hljs">$ brew install lua</code></pre>
</figure>

<h4 id="installing-lua-linux">Linux</h4>
<p>
  On Linux, installing Lua is as straight-forward as using the
  <strong>system package manager</strong>. For example, on Debian, Ubuntu, and
  Mint:
</p>
<figure>
  <pre><code class="language-shell hljs">$ apt install lua5.3</code></pre>
</figure>
<p>
  Take a look at
  <a
    href="https://www.lua.org/manual/5.4/readme.html#install"
    title="Guide on how to install Lua, alternatively from source."
    >Lua's installation guide</a
  >
  to build a more recent version from source if needed.
</p>

<h4 id="installing-lua-windows">Windows</h4>
<p>
  On Windows, there is a list of
  <a
    href="https://luabinaries.sourceforge.net"
    title="Pre-compiled binaries ready to be installed on Windows."
    >available Lua binaries</a
  >, offering pre-compiled Lua versions ready to be used. Scrolling down on that
  page to the <em>History</em> section, the latest available pre-compiled
  versions can be found. Choosing one, for example
  <a
    href="https://sourceforge.net/projects/luabinaries/files/5.4.2/"
    title="Pre-compiled Windows binary for Lua version 5.4.2."
    >version 5.4.2</a
  >, will lead to SourceForge; click the <em>Tools Executables</em> folder next.
</p>
<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/source-forge-lua-download-1.png"
      alt="A screenshot of the SourceForge website, showing multiple download entries for Lua, with the 'Tools Executables' entry highlighted."
      loading="lazy"
      width="1360"
      height="665"
    />
  </picture>
  <figcaption>
    The <em>Tools Executables</em> folder is where Lua is to be found.
  </figcaption>
</figure>
<p>
  Here is the option of picking either the 32-bit or the 64-bit version,
  depending on the used system.
</p>
<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/source-forge-lua-download-2.png"
      alt="A screenshot of the SourceForge website, showing a list of Lua downloads for different system versions."
      loading="lazy"
      width="1360"
      height="890"
    />
  </picture>
  <figcaption>
    Select the version matching the <abbr title="Operating System">OS</abbr>.
  </figcaption>
</figure>
<p>
  After the download, the archive contents can be extracted, finding, depending
  on the downloaded version, an executable. For version 5.4.x this is called
  <code>lua54</code>.
</p>
<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/windows-folder-with-lua.png"
      alt="An open Windows Explorer window, the Downloads folder is selected showing the extracted files from the Lua download. The file 'lua54' is highlighted."
      loading="lazy"
      width="1360"
      height="532"
    />
  </picture>
  <figcaption>The contents of the extracted archive.</figcaption>
</figure>
<p>
  Double-clicking that file will <strong>open a terminal</strong>, from which
  Lua can be run. Alternatively, this file can be placed in a folder that is
  part of the PATH variable or
  <a
    href="https://learn.microsoft.com/en-us/previous-versions/office/developer/sharepoint-2010/ee537574(v=office.14)#to-add-a-path-to-the-path-environment-variable"
    title="Microsoft page about how to edit the PATH variable under Windows."
    >made available through it</a
  >.
</p>
<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/windows-lua-terminal.png"
      alt="Part of a black windows terminal showing the Lua welcome message when running in interactive mode."
      loading="lazy"
      width="1360"
      height="306"
    />
  </picture>
  <figcaption>A terminal ready to run Lua.</figcaption>
</figure>

<h3 id="hello-world">Hello World</h3>
<div class="side-note-ref">
  <p>
    With Lua installed, it's time to
    <strong>create a small test program</strong> to verify that everything works
    as expected. Creating a source file inside a dedicated project folder*,
    <code>src/main.lua</code>, saying hello to everyone.
  </p>
  <aside class="side-note">
    <p>
      * All files and folders from the article series will go inside the same
      project folder, with at least one subfolder <code>src/</code>.
    </p>
  </aside>
</div>
<figure>
  <pre><code class="language-lua hljs">-- src/main.lua
local greeting = "Hello, reader."
print(greeting)</code></pre>
  <figcaption>A simple <em>"Hello World" program in Lua.</em></figcaption>
</figure>
<p>
  Executing that file via the terminal from inside the project directory will
  print the greeting.
</p>
<figure>
  <pre><code class="language-shell hljs">$ lua src/main.lua
Hello, reader.</code></pre>
</figure>

<h3 id="dependency-management-with-luarocks">
  Dependency management with LuaRocks
</h3>
<p>
  <a href="https://luarocks.org" title="A well known Lua package manager."
    >LuaRocks, the de facto standard package manager for Lua</a
  >, will be used to manage project dependencies. First, the LuaRocks
  command-line tool needs to be installed on the system.
</p>

<h4 id="dependency-management-with-luarocks-macos">macOS</h4>
<p>
  Again, using brew on macOS, LuaRocks can be installed with a single command.
</p>
<figure>
  <pre><code class="language-shell hljs">$ brew install luarocks</code></pre>
</figure>

<h4 id="dependency-management-with-luarocks-linux">Linux</h4>
<p>
  Same for Linux; a single command does the job using the system package
  manager.
</p>
<figure>
  <pre><code class="language-shell hljs">$ apt install luarocks</code></pre>
</figure>

<h4 id="dependency-management-with-luarocks-windows">Windows</h4>
<p>
  First, the LuaRocks executable needs to be downloaded, either 32-bit or
  64-bit. The downloads are at the top of the
  <a
    href="https://github.com/luarocks/luarocks/wiki/Download"
    title="Download a LuaRocks executable on GitHub."
    >LuaRocks download page</a
  >
  on GitHub. After downloading and extracting the files, the
  <code>luarocks.exe</code> needs to be
  <a
    href="https://learn.microsoft.com/en-us/previous-versions/office/developer/sharepoint-2010/ee537574(v=office.14)#to-add-a-path-to-the-path-environment-variable"
    title="Microsoft page about how to edit the PATH variable under Windows."
    >added to the PATH</a
  >
  to make it available as <code>luarocks</code> command from the terminal.
</p>

<h3 id="project-folder-setup">Project folder setup</h3>
<p>
  With LuaRocks installed, the <code>init</code> command helps to set up a
  project, including <strong>local dependency management</strong>. This means
  dependencies will be installed inside the project folder in a
  <code>lua_modules</code> directory.
</p>
<figure>
  <pre><code class="language-shell hljs">$ luarocks init --lua-versions "5.1,5.2,5.3,5.4"</code></pre>
  <figcaption>
    This will mark the project's Lua support for version 5.1 and up.
  </figcaption>
</figure>
<p>
  The <code>init</code> command will do a couple of things, some of which are:
</p>
<ul>
  <li>
    Creating the <code>lua_module</code> folder and storing all installed
    dependencies.
  </li>
  <li>
    Detecting the <code>src/main.lua</code> as the main entry point of the
    program.
  </li>
  <li>
    Add two shortcuts that can be used for executing <code>lua</code> and
    <code>luarocks</code> from inside the project.
  </li>
  <li>
    Adding a <code>.luarocks</code> folder containing some configuration files
    and marking the directory as the root folder for LuaRocks.
  </li>
</ul>
<p>And two more I'll have a more <strong>detailed look at</strong>:</p>
<ul>
  <li>Creating or adding to an existing <code>.gitignore</code> file.</li>
  <li>
    Creating a <code>.rockspec</code> file with the base project settings and
    name, taken from the folder name LuaRocks was executed from.
  </li>
</ul>

<h3 id="gitignore">.gitignore</h3>
<p>
  The <code>luarocks init</code> command automatically generates a
  <code>.gitignore</code>, <strong>if not already present</strong>, or appends
  its entries to an existing <code>.gitignore</code> file. The following entries
  will be added.
</p>
<figure>
  <pre><code class="language-plaintext hljs">/luarocks
/lua
/lua_modules
/.luarocks</code></pre>
  <figcaption>.gitignore</figcaption>
</figure>
<p>
  The first two files are local shortcuts to execute <code>lua</code> and
  <code>luarocks</code>. Then comes the dependency folder
  <code>lua_modules</code> and the config folder <code>.luarocks</code>.
</p>

<h3 id="about-rockspec">About .rockspec</h3>
<p>
  The <code>.rockspec</code> file defines the project's properties, like name,
  version, and used dependencies. A complete list of the supported options can
  be found on the
  <a
    href="https://github.com/luarocks/luarocks/wiki/Rockspec-format#build-rules"
    title="LuaRocks wiki on GitHub will all available properties for the rockspec file."
    >official LuaRocks wiki page for build rules</a
  >.
</p>
<figure>
  <pre><code class="language-lua hljs">-- lua-series-dev-1.rockspec
package = "lua-series"
version = "dev-1"
source = {
   url = "*** please add URL for source tarball, zip or repository here ***"
}
description = {
   homepage = "*** please enter a project homepage ***",
   license = "*** please specify a license ***"
}
dependencies = {
   "lua >= 5.1, < 5.5"
}
build = {
   type = "builtin",
   modules = {
      main = "src/main.lua"
   }
}</code></pre>
  <figcaption>
    Some entries are not filled yet. The file format is technically a Lua file.
  </figcaption>
</figure>
<p>
  At the top of the file, the rockspec format will be defined, indicating the
  format version, the latest being version 3.
</p>
<figure>
  <pre><code class="language-lua hljs">rockspec_format = "3.0"</code></pre>
</figure>
<p>
  The <code>source.url</code> can be many things; I usually point it to the
  project's git repository, but it can also be other repository types or
  <abbr>URL</abbr>s.
</p>
<figure>
  <pre><code class="language-lua hljs">source = {
   url = "https://github.com/MartinHelmut/lua-series.git"
}</code></pre>
  <figcaption>Adding a git repository <abbr>URL</abbr>.</figcaption>
</figure>
<p>
  The <code>description</code> can contain a summary, the project home page, a
  license, and more.
</p>
<figure>
  <pre><code class="language-lua hljs">description = {
   summary = "Companion repository to the Lua series.",
   homepage = "https://martin-fieber.de/series/lua/",
   license = "MIT"
}</code></pre>
  <figcaption>Adding some base description items.</figcaption>
</figure>
<p>
  Next comes the list of dependencies. This will hold all necessary project
  dependencies and one special dependency from the start: <code>lua</code>. Less
  of an actual dependency; more of the projects supported Lua versions or
  version range.
</p>
<figure>
  <pre><code class="language-lua hljs">dependencies = {
   "lua >= 5.1, < 5.5"
}</code></pre>
</figure>
<p>
  And at last, the project's build settings and modules &mdash; not yet
  utilized.
</p>
<figure>
  <pre><code class="language-lua hljs">build = {
   type = "builtin",
   modules = {
      main = "src/main.lua"
   }
}</code></pre>
  <figcaption>
    What is called <code>modules.main</code> here can also be the name of the
    project, e.g. <code>modules.luaseries</code>.
  </figcaption>
</figure>
<p>
  To ensure all changes to a <code>.rockspec</code> file are valid, the
  <code>luarocks lint</code>
  command can be used, giving it the filename to validate.
</p>
<figure>
  <pre><code class="language-shell hljs">$ luarocks lint lua-series-dev-1.rockspec</code></pre>
  <figcaption>
    This will indicate if there are problems with the
    <code>.rockspec</code> file.
  </figcaption>
</figure>
<p>And here is the final <code>.rockspec</code> file.</p>
<figure>
  <pre><code class="language-lua hljs">-- lua-series-dev-1.rockspec
rockspec_format = "3.0"
package = "lua-series"
version = "dev-1"
source = {
   url = "https://github.com/MartinHelmut/lua-series.git"
}
description = {
   summary = "The companion repository to my Lua blog series.",
   homepage = "https://martin-fieber.de/series/lua/",
   license = "MIT"
}
dependencies = {
   "lua >= 5.1, < 5.5"
}
build = {
   type = "builtin",
   modules = {
      main = "src/main.lua"
   }
}</code></pre>
</figure>

<h3 id="install-a-module">Install a module</h3>
<p>
  Let's install something, finally! The
  <a
    href="https://github.com/kikito/inspect.lua"
    title="GitHub page for the LuaRocks module 'inspect'."
    >inspect</a
  >
  module is handy in general, giving an easy way to print any value in Lua for
  inspection or debugging.
</p>
<figure>
  <pre><code class="language-shell hljs">$ luarocks install inspect</code></pre>
</figure>
<p>
  The new dependency also needs to be added to the <code>.rockspec</code> file
  to keep it on later installs.
</p>
<figure>
  <pre><code class="language-lua hljs">dependencies = {
   "lua >= 5.1, < 5.5",
   "inspect >= 3.1"
}</code></pre>
</figure>
<p>
  On a fresh checkout of the project, this will ensure that
  <code>inspect</code> is installed again when running
  <code>luarocks install --deps-only</code> on the <code>.rockspec</code> file.
</p>
<figure>
  <pre><code class="language-shell hljs">$ luarocks install --deps-only lua-series-dev-1.rockspec</code></pre>
  <figcaption>
    This will install all dependencies defined in the given
    <code>.rockspec</code> file inside a project.
  </figcaption>
</figure>
<p>Let's use <code>inspect</code> to print a test table.</p>
<figure>
  <pre><code class="language-lua hljs">-- src/main.lua
local inspect = require "inspect"
local output = { "Hello, reader.", 42 }

print(inspect(output))</code></pre>
</figure>
<p>Oh no, running <strong>this code will give an error</strong>.</p>
<figure>
  <pre><code class="language-shell hljs">$ lua src/main.lua
lua: src/main.lua:1: module 'inspect' not found:
  no field package.preload['inspect']
  no file '/opt/homebrew/share/lua/5.4/inspect.lua'
  no file '/opt/homebrew/share/lua/5.4/inspect/init.lua'
  no file '/opt/homebrew/lib/lua/5.4/inspect.lua'
  no file '/opt/homebrew/lib/lua/5.4/inspect/init.lua'
  no file './inspect.lua'
  no file './inspect/init.lua'
  no file '/opt/homebrew/lib/lua/5.4/inspect.so'
  no file '/opt/homebrew/lib/lua/5.4/loadall.so'
  no file './inspect.so'
stack traceback:
  [C]: in function 'require'
  src/main.lua:1: in main chunk
  [C]: in ?</code></pre>
  <figcaption>Continue reading for the solution.</figcaption>
</figure>

<h3 id="resolve-module-paths">Resolve module paths</h3>
<p>
  Despite having a way to manage dependencies, Lua still needs to be told
  <strong>where to find modules</strong> for the project. This is done through
  the <code>package.path</code> and <code>package.cpath</code> variables. My
  preferred way is to have a <code>src/setup.lua</code> file defining those.
</p>
<p>
  In that file, I can also put other project setup options later, as it will be
  loaded before running any Lua script.
</p>
<figure>
  <pre><code class="language-lua hljs">-- src/setup.lua
local version = _VERSION:match("%d+%.%d+")

package.path = 'lua_modules/share/lua/' .. version ..
    '/?.lua;lua_modules/share/lua/' .. version ..
    '/?/init.lua;' .. package.path
package.cpath = 'lua_modules/lib/lua/' .. version ..
    '/?.so;' .. package.cpath</code></pre>
  <figcaption>
    Overriding <code>package.path</code> and <code>package.cpath</code> to add
    local modules.
  </figcaption>
</figure>
<p>
  Now, there are two ways to use this setup: one is via the
  <code>-l</code> option of the <code>lua</code> command.
</p>
<figure>
  <pre><code class="language-shell hljs">$ lua -l src/setup src/main.lua</code></pre>
  <figcaption>
    Run <code>src/main.lua</code> with required <code>src/setup.lua</code>
    to find locally installed modules.
  </figcaption>
</figure>
<p>
  Another option is to set the <code>LUA_INIT</code> environment variable. This
  variable can either execute Lua code before running a script or load a file
  when the value starts with <code>@</code>.
</p>
<p>
  By defining the environment variable inside the terminal, Lua can be run
  without the <code>-l</code> option.
</p>
<figure>
  <pre><code class="language-shell hljs">export LUA_INIT="@src/setup.lua"</code></pre>
</figure>
<p>
  Optionally, to not pollute the environment or re-set the variable every time,
  I use <a href="https://direnv.net" title="Website for direnv">direnv</a>,
  defining a <code>.envrc</code> with my projects' environment variables that
  will only be loaded when working inside the respective project folder.
</p>
<div class="side-note-ref">
  <p>
    There are
    <a
      href="https://github.com/direnv/direnv/releases"
      title="List of releases for direnv on GitHub."
      >releases for all platforms</a
    >, including Windows*, and comprehensive documentation, so I won't go into
    detail here as this is an <strong>optional setup step</strong>.
  </p>
  <aside class="side-note">
    <p>
      * Downloading the binary and adding it to the PATH is the base Windows
      setup.
    </p>
  </aside>
</div>
<p>
  Having that done, one way or another, I assume from here that the
  <code>LUA_INIT</code> variable is set and the test script with the
  <code>inspect</code> module can be run again.
</p>
<figure>
  <pre><code class="language-shell hljs">$ lua src/main.lua
{ "Hello, reader.", 42 }</code></pre>
  <figcaption>Success, at last.</figcaption>
</figure>
<p>
  <strong>Remark:</strong> The <code>package.path</code> variable can also be
  used to solve inner project module resolution. Let's say all files will be
  located inside a <code>src/</code> folder, adding <code>'src/?.lua'</code> at
  the end will enable looking up modules from that directory.
</p>
<figure>
  <pre><code class="language-lua hljs">-- src/setup.lua
-- ...

package.path = 'lua_modules/share/lua/' .. version ..
    '/?.lua;lua_modules/share/lua/' .. version ..
    '/?/init.lua;' .. package.path .. ';src/?.lua'</code></pre>
  <figcaption>
    Adding <code>.. ';src/?.lua'</code> at the end to tell Lua to search for
    modules in <code>src/</code>.
  </figcaption>
</figure>

<h3 id="rock-trees">Rock trees</h3>
<p>
  It is important to note where packages are installed when using LuaRocks. So
  far, having the project set up via <code>luarocks init</code>, all packages
  were installed locally, inside the project folder. This is only the case due
  to the presence of the <code>.luarocks</code> and
  <code>lua_modules</code> folders. When this is not the case, packages are
  installed <strong>globally by default</strong> when a config file is not
  present.
</p>
<p>
  Another option when not in a project is using the <code>--local</code> flag.
  <strong>Be aware:</strong> this does not mean local as in
  <em>"local folder"</em>, this means local as in
  <em>"the user's home directory"</em>. To really get a local installation, for
  example, inside the current working directory, the <code>--tree</code> flag
  needs to be used, passing the path to a folder.
</p>
<figure>
  <pre><code class="language-shell hljs">$ luarocks install --tree=lua_modules inspect</code></pre>
  <figcaption>
    Install <code>inspect</code> inside in <code>lua_modules</code> inside the
    current working directory.
  </figcaption>
</figure>

<h3 id="enable-local-scripts">Enable local scripts</h3>
<p>
  Before continuing to add more tools to the project setup, it is quite handy to
  enable the execution of local scripts. When installing an executable with
  LuaRocks those binaries are installed in the
  <code>lua_modules/bin</code> folder.
</p>
<p>To execute a script, the full path needs to be used.</p>
<figure>
  <pre><code class="language-shell hljs">$ ./lua_modules/bin/some-script --argument ...</code></pre>
</figure>
<p>
  To simplify this, the local bin folder can be added to the system PATH, which
  is especially handy when already using
  <a href="https://direnv.net" title="Website for direnv">direnv</a>.
</p>
<figure>
  <pre><code class="language-shell hljs"># .envrc
export LUA_INIT="@src/setup.lua"
export PATH=$PATH:./lua_modules/bin</code></pre>
  <figcaption>Example <code>.envrc</code> file when using direnv.</figcaption>
</figure>
<p>
  The same example command above then becomes the following when executed inside
  the project directory.
</p>
<figure>
  <pre><code class="language-shell hljs">$ some-script --argument ...</code></pre>
  <figcaption>
    Accessing the local <code>lua_modules/bin</code> folder to find the script
    named <code>some-script</code>.
  </figcaption>
</figure>

<h3 id="auto-format-code">Auto format code</h3>
<p>
  I much appreciate <strong>auto code formatting</strong> from other projects
  and languages, like
  <a
    href="https://prettier.io"
    title="Prettier website, a code formatter for JavaScript and TypeScript."
    >Prettier</a
  >
  for JavaScript and TypeScript or
  <a
    href="https://clang.llvm.org/docs/ClangFormat.html"
    title="Website for clang-format, part of LLVM."
    >clang-format</a
  >
  for C++. I also want automatic code formatting for Lua.
</p>
<p>
  <a
    href="https://github.com/Koihik/LuaFormatter"
    title="GitHub page of LuaFormatter, Lua code formatter."
    >LuaFormatter</a
  >, my tool of choice, installed via LuaRocks and thereafter available via the
  <code>lua_modules/bin</code> folder.
</p>
<figure>
  <pre><code class="language-shell hljs">$ luarocks install \
    --server=https://luarocks.org/dev luaformatter</code></pre>
</figure>
<p>
  Custom format options can be defined in a <code>.lua-format</code>
  <abbr>YAML</abbr> file inside the project root. I'll only change a few options
  for my projects.
</p>
<figure>
  <pre><code class="language-yaml hljs"># .lua-format
keep_simple_control_block_one_line: false
keep_simple_function_one_line: false
column_table_limit: 1</code></pre>
  <figcaption>
    <a
      href="https://github.com/Koihik/LuaFormatter#default-configuration"
      title="Default configuration page of LuaFormatter on GitHub."
      >List of default format options for LuaFormatter.</a
    >
  </figcaption>
</figure>
<p>
  With the
  <a
    href="#enable-local-scripts"
    title="Section earlier on this page to enable local scripts."
    >local script setup enabled</a
  >
  or using the path to the executable, the formatter can be run, and all Lua
  files are automatically formatted.
</p>
<figure>
  <pre><code class="language-shell hljs">$ lua-format --in-place src/**/*.lua</code></pre>
  <figcaption>
    This will format and rewrite all files in <code>src</code>.
  </figcaption>
</figure>

<h3 id="static-analysis">Static analysis</h3>
<p>
  To lint the project code base,
  <a
    href="https://github.com/mpeterv/luacheck"
    title="Luacheck website on GitHub."
    >Luacheck</a
  >
  can be used, which is an executable installed via LuaRocks into the
  <code>lua_modules/bin</code>
  folder.
</p>
<figure>
  <pre><code class="language-shell hljs">$ luarocks install luacheck</code></pre>
</figure>
<p>
  Keeping the default options, it can be run on all files inside
  <code>src</code>. A full list of all options can be found in the
  <a
    href="https://luacheck.readthedocs.io/en/stable/warnings.html"
    title="Documentation about available warnings in Luacheck."
    >official Luacheck documentation</a
  >.
</p>
<figure>
  <pre><code class="language-shell hljs">$ luacheck src
Checking src/main.lua                             OK
Checking src/setup.lua                            OK

Total: 0 warnings / 0 errors in 2 files</code></pre>
</figure>

<h3 id="editor-setup">Editor setup</h3>
<p>
  No project setup is complete without setting up an editor environment. To have
  some options, <strong>I picked five</strong> well-known ones: an IntelliJ IDE,
  in this case <a href="#editor-setup-jetbrains">CLion</a> (paid),
  <a href="#editor-setup-visual-studio-code">VS Code</a> (free),
  <a href="#editor-setup-sublime-text">Sublime Text 4</a> (paid), and
  <a href="#editor-setup-zerobrane">ZeroBrane</a> (free).
</p>

<h4 id="editor-setup-jetbrains">JetBrains (CLion)</h4>
<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/editor-jetbrains-intellij.png"
      alt="Screenshot of IntelliJ IDE with the open Lua series project."
      loading="lazy"
      width="1360"
      height="797"
    />
  </picture>
  <figcaption>The Lua series project open in CLion.</figcaption>
</figure>
<p>
  Using any
  <a
    href="https://www.jetbrains.com"
    title="Website of JetBrains, tools for software development."
    >JetBrains</a
  >
  product (e.g.
  <a
    href="https://www.jetbrains.com/clion/"
    title="JetBrains' CLion landing page, cross-platform IDE for C and C++."
    >CLion</a
  >) for Lua development, I use the plugin
  <a href="https://github.com/redhat-developer/lsp4ij" title="">LSP4IJ</a> to
  support language server clients with
  <a href="https://plugins.jetbrains.com/plugin/22315-sumnekolua" title=""
    >SumnekoLua</a
  >, the Lua language server plugin for IntelliJ products. It comes with dynamic
  type checking, formatting, find reference, simple refactoring capabilities,
  and documentation support, to name a few.
</p>
<p>
  It does <strong>not support debugging</strong> though, so breakpoints won't
  work and
  <a
    href="/blog/debugging-and-profiling-lua/"
    title="Article about debugging and profiling Lua, including a small performance tracer."
    >other ways to debug</a
  >
  need to be utilized.
</p>
<p>
  To then run Lua files directly from the IDE, a run configuration needs to be
  provided.
</p>
<p>
  To get a run configuration going, CLion needs a build target defined. In
  settings look for <em>Build, Execution, Deployment</em> &rarr;
  <em>Custom Build Target</em>.
</p>
<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/editor-clion-target.png"
      alt="The CLion settings window, showing the 'Custom Build Target' section."
      loading="lazy"
      width="1360"
      height="638"
    />
  </picture>
</figure>
<p>
  Create a new build target and name it <em>"Lua"</em>, leaving all other
  options as they are.
</p>
<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/editor-clion-new-target.png"
      alt="The CLion settings window, showing the 'Custom Build Target' section with a new build called 'Lua'."
      loading="lazy"
      width="1360"
      height="1086"
    />
  </picture>
</figure>
<p>
  That's for the target definition. Closing the settings window, the actual run
  configuration now needs to be defined.
</p>
<p>
  On the <strong>right side in the top toolbar</strong> is, when no
  configuration exists, a button saying <em>"Edit Configurations&hellip;"</em>.
  If a configuration already exists the same option is in the dropdown where the
  configuration is selected.
</p>
<p>Opening that configuration will show a window like the following.</p>
<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/editor-clion-run-config.png"
      alt="The CLion Run and Debug configuration window."
      loading="lazy"
      width="1360"
      height="942"
    />
  </picture>
</figure>
<p>
  This is where the run config will be created. Add a new configuration as
  <em>"Native Application"</em>.
</p>
<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/editor-clion-run-config-new.png"
      alt="The CLion Run and Debug configuration window, with an open sub-window for creating a new configuration."
      loading="lazy"
      width="1360"
      height="942"
    />
  </picture>
</figure>
<div class="side-note-ref">
  <p>
    Select the newly created <em>"Lua"</em> target as runner target. Name the
    new configuration <em>"Lua"</em>, executable is <code>lua</code>*. The
    program argument should be the current open file, set via the variable
    <code>$FilePathRelativeToProjectRoot$</code>. Working directory is the
    project directory.
  </p>
  <aside class="side-note">
    <p>
      *The Lua executable should be available in the PATH environment variable.
      If not, it can be
      <a
        href="/blog/lua-project-setup-with-luarocks/"
        title="My article about setting up Lua."
        >setup</a
      >
      or use the whole path to the executable.
    </p>
  </aside>
</div>
<p>
  The last but very important setting is the environment variable
  <code>LUA_INIT</code>. As discussed in the
  <a
    href="/blog/lua-project-setup-with-luarocks/#resolve-module-paths"
    title="How to resolve module paths, from the Lua setup article."
    >first part, setting up Lua</a
  >, this is to resolve LuaRocks module paths based on the
  <code>setup.lua</code> file.
</p>
<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/editor-clion-run-config-create.png"
      alt="The CLion Run and Debug configuration window, with a new configuration showing how to setup a Lua runner."
      loading="lazy"
      width="1360"
      height="942"
    />
  </picture>
  <figcaption>This is how the final configuration looks like.</figcaption>
</figure>
<p>
  After creating this configuration it is now possible to run Lua directly
  within CLion.
</p>
<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/editor-clion-run.png"
      alt="A CLion window showing how Lua is run directly from within the IDE. An open example Lua file with some simple print statements, a runner window at the bottom."
      loading="lazy"
      width="1360"
      height="941"
    />
  </picture>
</figure>

<h4 id="editor-setup-visual-studio-code">Visual Studio Code</h4>
<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/editor-microsoft-vscode.png"
      alt="Screenshot of VS Code editor with the open Lua series project."
      loading="lazy"
      width="1360"
      height="797"
    />
  </picture>
  <figcaption>The Lua series project open in VS Code.</figcaption>
</figure>
<p>
  For
  <a
    href="https://code.visualstudio.com"
    title="Microsoft's Visual Studio Code editor website."
    >VS Code</a
  >
  <strong>two plugins</strong> do the heavy lifting &mdash; the
  <a
    href="https://marketplace.visualstudio.com/items?itemName=sumneko.lua"
    title="Lua plugin page on VS Code marketplace."
    >Lua language server</a
  >
  providing language support including type checking, autocomplete, code
  formatting, documentation, and lots more; and the
  <a
    href="https://marketplace.visualstudio.com/items?itemName=actboy168.lua-debug"
    title="Lua Debug plugin page on VS Code marketplace."
    >Lua Debug</a
  >
  plugin for breakpoints and debugging support.
</p>
<p>
  Both plugins work out-of-the-box. Nevertheless, VS Code's setting
  <em>"Format on Save"</em> can be used to automatically format the code.
</p>
<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/vscode-format-on-save.png"
      alt="A screenshot of the settings in VS Code to enable 'format on save'. The checkbox is checked."
      loading="lazy"
      width="1360"
      height="512"
    />
  </picture>
  <figcaption>Makes life that much easier.</figcaption>
</figure>
<p>
  Thanks to the
  <a
    href="https://marketplace.visualstudio.com/items?itemName=actboy168.lua-debug"
    title="Lua Debug plugin page on VS Code marketplace."
    >Lua Debug</a
  >
  plugin it is possible to <strong>run Lua right from VS Code</strong>.
</p>
<div class="side-note-ref">
  <p>
    But, not when using LuaRocks due to modules not being resolved. To fix this,
    the <em>Lua Debug</em> extension supports setting <code>path</code> and
    <code>cpath</code> either through a
    <a
      href="https://code.visualstudio.com/docs/cpp/launch-json-reference"
      title="Official documentation for the launch.json file."
      >launch.json</a
    >
    or the
    <a
      href="https://code.visualstudio.com/docs/getstarted/settings"
      title="Official documentation for workspace settings."
      >workspace settings</a
    >, nevertheless, this <strong>did not work for me</strong> in any capacity*.
  </p>
  <aside class="side-note">
    <p>
      Here an
      <a
        href="https://github.com/actboy168/lua-debug/issues/202"
        title="Open issue regarding path and cpath being ignored."
        >open GitHub issue</a
      >
      mentioning the problem.
    </p>
  </aside>
</div>
<p>
  To make this work, loading modules installed through LuaRocks, I had to
  require the <code>setup.lua</code> file at the start of my main entry.
</p>
<figure>
  <pre><code class="language-lua hljs">-- src/main.lua
require "src/setup"

local inspect = require "inspect"
local output = {
  "Hello, reader.",
  42
}

print(inspect(output))</code></pre>
</figure>
<p>With this I'm able to run and debug Lua directly in VS Code.</p>

<h4 id="editor-setup-sublime-text">Sublime Text 4</h4>
<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/editor-sublime-text.png"
      alt="Screenshot of Sublime Text 4 editor with the open Lua series project."
      loading="lazy"
      width="1360"
      height="372"
    />
  </picture>
  <figcaption>The Lua series project open in Sublime Text 4.</figcaption>
</figure>
<p>
  Three plugins will enable working with Lua in Sublime Text, through
  <a href="https://packagecontrol.io" title="Official package control website"
    >package control</a
  >:
  <a href="https://packagecontrol.io/packages/LSP" title="LSP package page"
    >LSP</a
  >,
  <a
    href="https://packagecontrol.io/packages/LSP-lua"
    title="LSP Lua package page"
    >LSP-lua</a
  >, and
  <a
    href="https://packagecontrol.io/packages/Direnv"
    title="Direnv package page"
    >Direnv</a
  >.
</p>
<p>
  <abbr title="Language Server Protocol">LSP</abbr> is a general package to
  enable language server protocol support in Sublime. <em>LSP-lua</em> then is
  the Lua language server.
</p>
<p>
  The package <em>Direnv</em> is to enable
  <a href="https://direnv.net" title="Official direnv website">direnv</a>
  support. Direnv is what I use to set environment variables like
  <code>LUA_INIT</code> to load the <code>src/setup.lua</code> when running Lua
  to
  <a
    href="/blog/lua-project-setup-with-luarocks/#resolve-module-paths"
    title="First article in the series, showing how to resolve module paths."
    >enable a smooth LuaRocks integration</a
  >.
</p>
<p>
  I tried different packages but could
  <strong>not get support for debugging</strong> or breakpoints, therefore
  <a
    href="/blog/debugging-and-profiling-lua/"
    title="Article about debugging and profiling Lua, including a small performance tracer."
    >other ways to debug</a
  >
  need to be utilized.
</p>
<p>
  To properly integrate Lua into Sublime it is best done through a
  <a
    href="https://www.sublimetext.com/docs/projects.html"
    title="Sublime Text documentation about projects."
    >Sublime project</a
  >. Any open folder can be saved as a project, either by going through
  <em>Project</em> &rarr; <em>Save Project as &hellip;</em> in the menu or by
  creating a <code>.sublime-project</code> file.
</p>
<figure>
  <pre><code class="language-json hljs">{
  "folders": [
    {
      "path": "."
    }
  ]
}
</code></pre>
  <figcaption>
    Defining a project via a <code>*.sublime-project</code> file.
  </figcaption>
</figure>
<p>
  <strong>Autocomplete</strong> and the <strong>language server</strong> can be
  set up through the project file.
</p>
<figure>
  <pre><code class="language-json hljs">{
  "folders": [
    {
      "path": "."
    }
  ],
  "settings": {
    "auto_complete": true,
    "LSP": {
      "lua": {
        "enabled": true
      },
    },
  }
}
</code></pre>
  <figcaption>
    <code>some-name.sublime-project</code>
  </figcaption>
</figure>
<p>
  Through the <em>"direnv"</em> extension the <code>LUA_INIT</code> variable
  defined in <code>.envrc</code> is loaded. This will try to run the
  <code>src/setup.lua</code> file whenever Lua is run, to enable LuaRocks
  integration.
</p>
<p>
  To get this working it needs a <strong>custom build setup</strong> for Lua,
  defining the <code>working_dir</code> property to find the
  <code>src/setup.lua</code> file when running the build through Sublime.
</p>
<p>
  This gets defined through the project file. It will need a name, e.g.
  <em>"Lua"</em>, the <code>working_dir</code> that will be a variable called
  <code>$project_path</code>, the Lua command, a file regular expression, and
  source selector, telling sublime for what type of code the build is defined.
</p>
<figure>
  <pre><code class="language-json hljs">{
  "folders": [
    {
      "path": "."
    }
  ],
  "build_systems": [
    {
      "name": "Lua",
      "working_dir": "$project_path",
      "cmd": ["lua", "$file"],
      "file_regex": "^(?:lua:)?[\t ](...*?):([0-9]*):?([0-9]*)",
      "selector": "source.lua"
    }
  ],
  "settings": {
    "auto_complete": true,
    "LSP": {
      "lua": {
        "enabled": true
      },
    },
  }
}
</code></pre>
  <figcaption>
    <code>some-name.sublime-project</code>
  </figcaption>
</figure>
<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/editor-sublime-text-project.png"
      alt="Screenshot of Sublime Text 4 editor with the project setting file."
      loading="lazy"
      width="1360"
      height="890"
    />
  </picture>
  <figcaption>The whole project setting file.</figcaption>
</figure>
<p>
  The file regular expression
  <code>^(?:lua:)?[\t ](...*?):([0-9]*):?([0-9]*)</code> will be run against the
  build result and extract information to enable navigating the result on error
  in editor.
</p>
<p>
  Now, running Lua directly through Sublime is enabled through
  <em>Tools</em> &rarr; <em>Build</em> or the related shortcut.
</p>
<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/editor-sublime-text-check.png"
      alt="Screenshot of Sublime Text 4 editor running the project code directly through the editor."
      loading="lazy"
      width="1360"
      height="890"
    />
  </picture>
  <figcaption>Showing an example how Lua was run through Sublime.</figcaption>
</figure>

<h4 id="editor-setup-zerobrane">ZeroBrane</h4>
<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/zero-brane-studio.png"
      alt="The start screen of ZeroBrane Studio with the Lua series project opened."
      loading="lazy"
      width="1360"
      height="372"
    />
  </picture>
  <figcaption>The Lua series project open in ZeroBrane Studio.</figcaption>
</figure>
<p>
  <a
    href="https://studio.zerobrane.com"
    title="Website of ZeroBrane Studio, a lightweight Lua IDE."
    >ZeroBrane Studio</a
  >
  is an IDE focused on Lua development. It has a lot of features focused on Lua,
  including resources to learn the language right in the editor. It comes with
  everything needed to write and run Lua.
</p>
<p>
  The only thing I needed to provide separately was LuaRocks support. What
  worked best for me was to include the <code>src/setup.lua</code> file in my
  main entry.
</p>
<figure>
  <picture>
    <img
      src="/assets/blog/lua-series-part-1/zero-brane-running.png"
      alt="Running the Lua series project in ZeroBrane Studio. The editor open with the main file, at the bottom of the screen is some console output from running code."
      loading="lazy"
      width="1360"
      height="890"
    />
  </picture>
  <figcaption>The Lua series project open in ZeroBrane Studio.</figcaption>
</figure>

<h4 id="editor-setup-honorable-mentions">Honorable mention</h4>
<p>
  <a
    href="https://neovim.io"
    title="Website for the hyper-extensible Vim-based text editor."
    >Neovim</a
  >
  is another option that comes with Lua support out-of-the-box. Lua is built-in
  and plugins for the editor are written in it.
</p>
<p>
  <a
    href="https://defold.com"
    title="Website for the Defold game engine supporting Lua."
    >Defold</a
  >
  is a game engine using Lua as its scripting language. I comes with an editor
  that fully supports Lua including debugging capabilities.
</p>

<h3 id="what-comes-next">What comes next</h3>
<p>
  This article was specifically focused on getting a good environment running to
  develop Lua. Everything shown here can be found in the
  <a
    href="https://github.com/MartinHelmut/lua-series/tree/part-1"
    title="GitHub page of part 1 of the companion repository for this article series."
    >companion repository, branch part-1</a
  >.
</p>
<p>
  The
  <a
    href="/blog/create-build-publish-modules-for-lua"
    title="The next article in the series."
    >next article focuses on creating, building, and publishing new packages</a
  >; how to manage versions; and how to add documentation to them.
</p>
<p>Until then 👋🏻</p>
